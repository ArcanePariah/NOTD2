include "TriggerLibs/NativeLib"
include "Lib09BE6BA8"
include "Lib1E3F036D"
include "LibC50FD636"

include "Lib1497AA2D_h"

//--------------------------------------------------------------------------------------------------
// Library: Class Selection Testing
//--------------------------------------------------------------------------------------------------
// External Library Initialization
void lib1497AA2D_InitLibraries () {
    libNtve_InitVariables();
    lib1E3F036D_InitVariables();
    libC50FD636_InitVariables();
}

// Variable Initialization
bool lib1497AA2D_InitVariables_completed = false;

void lib1497AA2D_InitVariables () {
    if (lib1497AA2D_InitVariables_completed) {
        return;
    }

    lib1497AA2D_InitVariables_completed = true;

    lib1497AA2D_gv_armorSlotDropDown = c_invalidDialogControlId;
    lib1497AA2D_gv_unitModelFrameModel = c_invalidDialogControlId;
    lib1497AA2D_gv_classSelectionTimer = TimerCreate();
    lib1497AA2D_gv_classSelectionDialog = c_invalidDialogId;
    lib1497AA2D_gv_classSelectionPanel = c_invalidDialogControlId;
    lib1497AA2D_gv_classLoreFrame = c_invalidDialogControlId;
    lib1497AA2D_gv_classModelFrame = c_invalidDialogControlId;
}

// Functions
void lib1497AA2D_gf_CreateArmorSlotDropDown (int lp_dropDown) {
    int autoE4848139_ae;
    int autoE4848139_ai;

    // Variable Declarations
    int lv_currentArmorSlot;

    // Variable Initialization

    // Implementation
    autoE4848139_ae = UserDataFieldValueCount("ArmorPieces", "Armor Path");
    autoE4848139_ai = 1;
    lv_currentArmorSlot = 1;
    for ( ; ( (autoE4848139_ai >= 0 && lv_currentArmorSlot <= autoE4848139_ae) || (autoE4848139_ai <= 0 && lv_currentArmorSlot >= autoE4848139_ae) ) ; lv_currentArmorSlot += autoE4848139_ai ) {
        DialogControlAddItem(lp_dropDown, PlayerGroupAll(), StringToText(UserDataGetString("ArmorPieces", "Light Armor", "Armor Path", lv_currentArmorSlot)));
    }
}

void lib1497AA2D_gf_CreateArmorSetDropDown () {
}

bool lib1497AA2D_gf_PlayerHasClassUnlocked (int lp_player, int lp_classSlot) {
    // Implementation
    if (((lp_classSlot < 6) || (GameAttributeGameValue("1") == "0003"))) {
        return true;
    }
    else {
        return false;
    }
}

void lib1497AA2D_gf_ClassUnlocked (int lp_classSlot) {
    // Variable Declarations
    int lv_buttonImage;

    // Variable Initialization
    lv_buttonImage = c_invalidDialogControlId;

    // Implementation
    DialogControlHookup(lib1497AA2D_gv_classSelectionButtons[lp_classSlot], c_triggerControlTypeImage, "ClassImage");
    lv_buttonImage = DialogControlLastCreated();
    libNtve_gf_SetDialogItemImage(lv_buttonImage, UserDataGetImagePath("Classes", UserDataInstance("Classes", lp_classSlot), "Class Image", 1), PlayerGroupAll());
}

// Triggers
//--------------------------------------------------------------------------------------------------
// Trigger: Create Drop Downs
//--------------------------------------------------------------------------------------------------
bool lib1497AA2D_gt_CreateDropDowns_Func (bool testConds, bool runActions) {
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1497AA2D_gt_CreateDropDowns_Init () {
    lib1497AA2D_gt_CreateDropDowns = TriggerCreate("lib1497AA2D_gt_CreateDropDowns_Func");
}

//--------------------------------------------------------------------------------------------------
// Trigger: Dropdown Selection
//--------------------------------------------------------------------------------------------------
bool lib1497AA2D_gt_DropdownSelection_Func (bool testConds, bool runActions) {
    // Actions
    if (!runActions) {
        return true;
    }

    TriggerDebugOutput(1, IntToText(DialogControlGetSelectedItem(EventDialogControl(), 1)), true);
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1497AA2D_gt_DropdownSelection_Init () {
    lib1497AA2D_gt_DropdownSelection = TriggerCreate("lib1497AA2D_gt_DropdownSelection_Func");
}

//--------------------------------------------------------------------------------------------------
// Trigger: Start Test
//--------------------------------------------------------------------------------------------------
bool lib1497AA2D_gt_StartTest_Func (bool testConds, bool runActions) {
    // Actions
    if (!runActions) {
        return true;
    }

    TriggerSendEvent(lib1497AA2D_gv_classSelectionEvent);
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1497AA2D_gt_StartTest_Init () {
    lib1497AA2D_gt_StartTest = TriggerCreate("lib1497AA2D_gt_StartTest_Func");
    TriggerAddEventTimeElapsed(lib1497AA2D_gt_StartTest, 0.0, c_timeGame);
}

//--------------------------------------------------------------------------------------------------
// Trigger: Display Class Selection
//--------------------------------------------------------------------------------------------------
bool lib1497AA2D_gt_DisplayClassSelection_Func (bool testConds, bool runActions) {
    int autoC17D44E1_ae;
    int autoC17D44E1_ai;

    // Variable Declarations
    int lv_classFrame;
    int lv_player;
    int lv_playerRankIcon;
    int lv_playerNameLabel;
    int lv_currentClassFrame;

    // Variable Initialization
    lv_playerRankIcon = c_invalidDialogControlId;
    lv_playerNameLabel = c_invalidDialogControlId;
    lv_currentClassFrame = c_invalidDialogControlId;

    // Actions
    if (!runActions) {
        return true;
    }

    SoundChannelMute(PlayerGroupAll(), c_soundCategoryAmbient, true);
    SoundChannelMute(PlayerGroupAll(), c_soundCategorySAmbient, true);
    SoundChannelMute(PlayerGroupAll(), c_soundCategorySEmitters, true);
    SoundChannelMute(PlayerGroupAll(), c_soundCategoryMusic, true);
    PlayerGroupLoopBegin(PlayerGroupAll());
    for ( ; !PlayerGroupLoopDone() ; PlayerGroupLoopStep() ) {
        CameraPan(PlayerGroupLoopCurrent(), Point(0.0, 0.0), 0.0, -1, 10.0, false);
        CameraLockInput(PlayerGroupLoopCurrent(), true);
    }
    PlayerGroupLoopEnd();
    TimerStart(lib1497AA2D_gv_classSelectionTimer, 5000.0, false, c_timeReal);
    TriggerEnable(lib1497AA2D_gt_ClassSelection, true);
    TriggerEnable(lib1497AA2D_gt_EndClassSelection, true);
    DialogCreate(500, 400, c_anchorCenter, 0, 0, true);
    lib1497AA2D_gv_classSelectionDialog = DialogLastCreated();
    DialogSetFullscreen(DialogLastCreated(), true);
    DialogControlCreateFromTemplate(DialogLastCreated(), c_triggerControlTypePanel, "ClassSelection/ClassSelection");
    lib1497AA2D_gv_classSelectionPanel = DialogControlLastCreated();
    DialogControlSetFullDialog(lib1497AA2D_gv_classSelectionPanel, PlayerGroupAll(), true);
    autoC17D44E1_ae = lib1497AA2D_gv_numberofClasses;
    autoC17D44E1_ai = 1;
    lv_classFrame = 1;
    for ( ; ( (autoC17D44E1_ai >= 0 && lv_classFrame <= autoC17D44E1_ae) || (autoC17D44E1_ai <= 0 && lv_classFrame >= autoC17D44E1_ae) ) ; lv_classFrame += autoC17D44E1_ai ) {
        DialogControlHookup(lib1497AA2D_gv_classSelectionPanel, c_triggerControlTypePanel, "ClassFrame" + IntToString(lv_classFrame));
        lib1497AA2D_gv_classSelectionFrames[lv_classFrame] = DialogControlLastCreated();
        DialogControlHookup(lib1497AA2D_gv_classSelectionFrames[lv_classFrame], c_triggerControlTypeButton, "ClassButton");
        lib1497AA2D_gv_classSelectionButtons[lv_classFrame] = DialogControlLastCreated();
        DialogControlHookup(lib1497AA2D_gv_classSelectionFrames[lv_classFrame], c_triggerControlTypeLabel, "ClassLabel");
        lib1497AA2D_gv_classSelectionLabels[lv_classFrame] = DialogControlLastCreated();
        libNtve_gf_SetDialogItemText(lib1497AA2D_gv_classSelectionLabels[lv_classFrame], UserDataGetText("Classes", UserDataInstance("Classes", lv_classFrame), "Class Name", 1), PlayerGroupAll());
        lib1497AA2D_gf_ClassUnlocked(lv_classFrame);
    }
    DialogControlHookup(lib1497AA2D_gv_classSelectionPanel, c_triggerControlTypeLabel, "PlayerName");
    lv_playerNameLabel = DialogControlLastCreated();
    DialogControlHookup(lib1497AA2D_gv_classSelectionPanel, c_triggerControlTypeImage, "PlayerRankIcon");
    lv_playerRankIcon = DialogControlLastCreated();
    DialogControlHookup(lib1497AA2D_gv_classSelectionPanel, c_triggerControlTypeLabel, "ClassLoreFrame");
    lib1497AA2D_gv_classLoreFrame = DialogControlLastCreated();
    DialogControlHookup(lib1497AA2D_gv_classSelectionPanel, c_triggerControlTypeUnitModel, "ClassModelPreview");
    lib1497AA2D_gv_classModelFrame = DialogControlLastCreated();
    DialogControlHookup(lib1497AA2D_gv_classSelectionPanel, c_triggerControlTypePulldown, "ArmorSlotPulldown");
    lib1497AA2D_gv_armorSlotDropDown = DialogControlLastCreated();
    lib1497AA2D_gf_CreateArmorSlotDropDown(lib1497AA2D_gv_armorSlotDropDown);
    TriggerAddEventDialogControl(lib1497AA2D_gt_DropdownSelection, c_playerAny, lib1497AA2D_gv_armorSlotDropDown, c_triggerControlEventTypeSelectionChanged);
    DialogSetVisible(lib1497AA2D_gv_classSelectionDialog, PlayerGroupAll(), true);
    lib1E3F036D_gf_ShowHideTeamUI(true);
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1497AA2D_gt_DisplayClassSelection_Init () {
    lib1497AA2D_gt_DisplayClassSelection = TriggerCreate("lib1497AA2D_gt_DisplayClassSelection_Func");
    TriggerAddEventGeneric(lib1497AA2D_gt_DisplayClassSelection, lib1497AA2D_gv_classSelectionEvent);
}

//--------------------------------------------------------------------------------------------------
// Trigger: Class Selection
//--------------------------------------------------------------------------------------------------
bool lib1497AA2D_gt_ClassSelection_Func (bool testConds, bool runActions) {
    // Variable Declarations
    int lv_classIndex;
    int lv_selectingPlayer;

    // Variable Initialization
    lv_selectingPlayer = EventPlayer();

    // Actions
    if (!runActions) {
        return true;
    }

    while ((EventDialogControl() != lib1497AA2D_gv_classSelectionButtons[lv_classIndex])) {
        lv_classIndex += 1;
    }
    libC50FD636_gv_marines[lv_selectingPlayer].lv_class = UserDataInstance("Classes", lv_classIndex);
    libNtve_gf_SetDialogItemText(lib1497AA2D_gv_classLoreFrame, UserDataGetText("Classes", libC50FD636_gv_marines[lv_selectingPlayer].lv_class, "Class Lore", 1), PlayerGroupSingle(lv_selectingPlayer));
    lib1E3F036D_gf_SetPlayerPortrait(lv_selectingPlayer, UserDataGetImagePath("Classes", libC50FD636_gv_marines[lv_selectingPlayer].lv_class, "Class Image", 1));
    libNtve_gf_SetDialogItemUnitLink(lib1497AA2D_gv_classModelFrame, UserDataGetUnit("Classes", libC50FD636_gv_marines[lv_selectingPlayer].lv_class, "Class Unit", 1), PlayerGroupSingle(lv_selectingPlayer));
    Wait(0.0625, c_timeGame);
    lib1497AA2D_gv_unitModelFrameActor = ActorFromDialogControl(lib1497AA2D_gv_classModelFrame);
    IntLoopBegin(lib1E3F036D_gv_indexBaseValue, lib1497AA2D_gv_numberofClasses);
    for ( ; !IntLoopDone() ; IntLoopStep() ) {
        if ((lib1497AA2D_gv_classSelectionButtons[IntLoopCurrent()] != EventDialogControl())) {
            libNtve_gf_SetDialogItemToggled(lib1497AA2D_gv_classSelectionButtons[IntLoopCurrent()], false, PlayerGroupSingle(lv_selectingPlayer));
        }
    }
    IntLoopEnd();
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1497AA2D_gt_ClassSelection_Init () {
    lib1497AA2D_gt_ClassSelection = TriggerCreate("lib1497AA2D_gt_ClassSelection_Func");
    TriggerEnable(lib1497AA2D_gt_ClassSelection, false);
    TriggerAddEventDialogControl(lib1497AA2D_gt_ClassSelection, c_playerAny, c_invalidDialogControlId, c_triggerControlEventTypeClick);
}

//--------------------------------------------------------------------------------------------------
// Trigger: End Class Selection
//--------------------------------------------------------------------------------------------------
bool lib1497AA2D_gt_EndClassSelection_Func (bool testConds, bool runActions) {
    // Actions
    if (!runActions) {
        return true;
    }

    SoundChannelMute(PlayerGroupAll(), c_soundCategoryAmbient, false);
    SoundChannelMute(PlayerGroupAll(), c_soundCategoryMusic, false);
    SoundChannelMute(PlayerGroupAll(), c_soundCategorySAmbient, false);
    SoundChannelMute(PlayerGroupAll(), c_soundCategorySEmitters, false);
    TriggerEnable(lib1497AA2D_gt_ClassSelection, false);
    TriggerEnable(lib1497AA2D_gt_EndClassSelection, false);
    PlayerGroupLoopBegin(PlayerGroupAll());
    for ( ; !PlayerGroupLoopDone() ; PlayerGroupLoopStep() ) {
        CameraLockInput(PlayerGroupLoopCurrent(), false);
    }
    PlayerGroupLoopEnd();
    DialogDestroy(lib1497AA2D_gv_classSelectionDialog);
    libNtve_gf_HideGameUI(true, PlayerGroupAll());
    UISetWorldVisible(PlayerGroupAll(), true);
    EnvironmentShow(c_environmentAll, true);
    GameSetMissionTimePaused(false);
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1497AA2D_gt_EndClassSelection_Init () {
    lib1497AA2D_gt_EndClassSelection = TriggerCreate("lib1497AA2D_gt_EndClassSelection_Func");
    TriggerEnable(lib1497AA2D_gt_EndClassSelection, false);
    TriggerAddEventTimer(lib1497AA2D_gt_EndClassSelection, lib1497AA2D_gv_classSelectionTimer);
}

void lib1497AA2D_InitTriggers () {
    lib1497AA2D_gt_CreateDropDowns_Init();
    lib1497AA2D_gt_DropdownSelection_Init();
    lib1497AA2D_gt_StartTest_Init();
    lib1497AA2D_gt_DisplayClassSelection_Init();
    lib1497AA2D_gt_ClassSelection_Init();
    lib1497AA2D_gt_EndClassSelection_Init();
}

//--------------------------------------------------------------------------------------------------
// Library Initialization
//--------------------------------------------------------------------------------------------------
bool lib1497AA2D_InitLib_completed = false;

void lib1497AA2D_InitLib () {
    if (lib1497AA2D_InitLib_completed) {
        return;
    }

    lib1497AA2D_InitLib_completed = true;

    lib1497AA2D_InitLibraries();
    lib1497AA2D_InitVariables();
    lib1497AA2D_InitTriggers();
}

