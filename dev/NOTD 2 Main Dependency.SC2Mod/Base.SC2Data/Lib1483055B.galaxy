include "TriggerLibs/NativeLib"
include "Lib09BE6BA8"
include "Lib135F852D"
include "Lib1E3F036D"
include "LibC50FD636"
include "Lib840A968C_h"

include "Lib1483055B_h"

//--------------------------------------------------------------------------------------------------
// Library: Class Selection
//--------------------------------------------------------------------------------------------------
// External Library Initialization
void lib1483055B_InitLibraries () {
    libNtve_InitVariables();
    lib1E3F036D_InitVariables();
    libC50FD636_InitVariables();
    lib840A968C_InitVariables();
}

// Variable Initialization
bool lib1483055B_InitVariables_completed = false;

void lib1483055B_InitVariables () {
    int init_i;

    if (lib1483055B_InitVariables_completed) {
        return;
    }

    lib1483055B_InitVariables_completed = true;

    lib1483055B_gv_armorSlotDropDown = c_invalidDialogControlId;
    for (init_i = 0; init_i <= lib1483055B_gv_classes; init_i += 1) {
        lib1483055B_gv_classSelectionButtons[init_i] = c_invalidDialogControlId;
    }
    lib1483055B_gv_unitModelFrameModel = c_invalidDialogControlId;
    for (init_i = 0; init_i <= lib1483055B_gv_classes; init_i += 1) {
        lib1483055B_gv_classSelectionLabels[init_i] = c_invalidDialogControlId;
    }
    for (init_i = 0; init_i <= lib1483055B_gv_classes; init_i += 1) {
        lib1483055B_gv_classSelectionFrames[init_i] = c_invalidDialogControlId;
    }
    lib1483055B_gv_classSelectionTimer = TimerCreate();
    lib1483055B_gv_classSelectionDialog = c_invalidDialogId;
    lib1483055B_gv_classSelectionPanel = c_invalidDialogControlId;
    lib1483055B_gv_classLoreFrame = c_invalidDialogControlId;
    lib1483055B_gv_classModelFrame = c_invalidDialogControlId;
}

// Functions
void lib1483055B_gf_CreateArmorSlotDropDown (int lp_dropDown) {
    int auto6AE87473_ae;
    int auto6AE87473_ai;

    // Variable Declarations
    int lv_currentArmorSlot;

    // Variable Initialization

    // Implementation
    auto6AE87473_ae = UserDataInstanceCount("ArmorPiece");
    auto6AE87473_ai = 1;
    lv_currentArmorSlot = 1;
    for ( ; ( (auto6AE87473_ai >= 0 && lv_currentArmorSlot <= auto6AE87473_ae) || (auto6AE87473_ai <= 0 && lv_currentArmorSlot >= auto6AE87473_ae) ) ; lv_currentArmorSlot += auto6AE87473_ai ) {
        DialogControlAddItem(lp_dropDown, PlayerGroupAll(), UserDataGetText("ArmorPiece", UserDataInstance("ArmorPiece", lv_currentArmorSlot), "Display Name", 1));
    }
}

void lib1483055B_gf_CreateArmorSetDropDown () {
}

bool lib1483055B_gf_PlayerHasClassUnlocked (int lp_player, int lp_classSlot) {
    // Implementation
    if (((lp_classSlot < 6) || (GameAttributeGameValue("1") == "0003"))) {
        return true;
    }
    else {
        return false;
    }
}

void lib1483055B_gf_ClassUnlocked (int lp_classSlot) {
    // Variable Declarations
    int lv_buttonImage;

    // Variable Initialization
    lv_buttonImage = c_invalidDialogControlId;

    // Implementation
    DialogControlHookup(lib1483055B_gv_classSelectionButtons[lp_classSlot], c_triggerControlTypeImage, "ClassImage");
    lv_buttonImage = DialogControlLastCreated();
    PlayerGroupLoopBegin(lib840A968C_gf_GetMarineSquadPlayers());
    for ( ; !PlayerGroupLoopDone() ; PlayerGroupLoopStep() ) {
        if (lib1483055B_gf_PlayerHasClassUnlocked(PlayerGroupLoopCurrent(), lp_classSlot)) {
            libNtve_gf_SetDialogItemImage(lv_buttonImage, UserDataGetImagePath("Classes", UserDataInstance("Classes", lp_classSlot), "Class Image", 1), PlayerGroupSingle(PlayerGroupLoopCurrent()));
        }
        else {
            libNtve_gf_SetDialogItemImage(lv_buttonImage, "btn-ability-terran-lockdown-classic.dds", PlayerGroupSingle(PlayerGroupLoopCurrent()));
            DialogControlSetEnabled(lib1483055B_gv_classSelectionButtons[lp_classSlot], PlayerGroupSingle(PlayerGroupLoopCurrent()), false);
        }
    }
    PlayerGroupLoopEnd();
}

void lib1483055B_gf_ClassSelected (trigger t) {
    // Implementation
    TriggerAddEventGeneric(t, lib1483055B_gv_classSelectEvent);
}

void lib1483055B_gf_AnnounceClassSelection (string lp_class, int lp_selectingPlayer) {
    // Implementation
    DataTableSetString(false, TriggerEventParamName(lib1483055B_gv_classSelectEvent, lib1483055B_gv_classSelected), (lp_class));
    DataTableSetInt(false, TriggerEventParamName(lib1483055B_gv_classSelectEvent, lib1483055B_gv_choosingPlayer), lp_selectingPlayer);
    TriggerSendEvent(lib1483055B_gv_classSelectEvent);
}

string lib1483055B_gf_GetClassSelected () {
    int auto2FE3898D_u;

    // Variable Declarations
    string lv_testInstance;

    // Variable Initialization

    // Implementation
    auto2FE3898D_u = 1;
    for ( ; auto2FE3898D_u <= UserDataInstanceCount("Classes"); auto2FE3898D_u += 1)
    {
        lv_testInstance = UserDataInstance("Classes", auto2FE3898D_u);
        if ((DataTableGetString(false, TriggerEventParamName(lib1483055B_gv_classSelectEvent, lib1483055B_gv_classSelected)) == (lv_testInstance))) {
            return lv_testInstance;
        }

        ;
    }
    return "Rifleman";
}

int lib1483055B_gf_GetSelectingPlayer () {
    // Implementation
    return DataTableGetInt(false, TriggerEventParamName(lib1483055B_gv_classSelectEvent, lib1483055B_gv_choosingPlayer));
}

// Triggers
//--------------------------------------------------------------------------------------------------
// Trigger: Dropdown Selection
//--------------------------------------------------------------------------------------------------
bool lib1483055B_gt_DropdownSelection_Func (bool testConds, bool runActions) {
    // Variable Declarations
    actor lv_selectedArmorActor;

    // Variable Initialization
    lv_selectedArmorActor = ActorFromScope(ActorScopeFromActor(lib1483055B_gv_unitModelFrameActor), (UserDataGetActor("ArmorPiece", UserDataInstance("ArmorPiece", DialogControlGetSelectedItem(EventDialogControl(), EventPlayer())), "Armor Actor", 1)));

    // Actions
    if (!runActions) {
        return true;
    }

    ActorScopeSend(ActorScopeFromActor(lib1483055B_gv_unitModelFrameActor), "HaloStop");
    Wait(0.0625, c_timeGame);
    ActorSend(lv_selectedArmorActor, "HaloSetColor 255,255,255");
    ActorSend(lv_selectedArmorActor, "HaloStart");
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1483055B_gt_DropdownSelection_Init () {
    lib1483055B_gt_DropdownSelection = TriggerCreate("lib1483055B_gt_DropdownSelection_Func");
}

//--------------------------------------------------------------------------------------------------
// Trigger: Display Class Selection
//--------------------------------------------------------------------------------------------------
bool lib1483055B_gt_DisplayClassSelection_Func (bool testConds, bool runActions) {
    int autoA5798C98_ae;
    int autoA5798C98_ai;
    playergroup autoE289EBC5_g;
    int autoE289EBC5_p;

    // Variable Declarations
    int lv_classFrame;
    int lv_player;
    int lv_playerRankIcon;
    int lv_playerNameLabel;
    int lv_currentClassFrame;

    // Variable Initialization
    lv_playerRankIcon = c_invalidDialogControlId;
    lv_playerNameLabel = c_invalidDialogControlId;
    lv_currentClassFrame = c_invalidDialogControlId;

    // Actions
    if (!runActions) {
        return true;
    }

    TriggerDebugOutput(lib840A968C_gv_gameEvents, StringExternal("Param/Value/lib_1483055B_FA1D6261"), false);
    SoundChannelMute(PlayerGroupAll(), c_soundCategoryAmbient, true);
    SoundChannelMute(PlayerGroupAll(), c_soundCategorySAmbient, true);
    SoundChannelMute(PlayerGroupAll(), c_soundCategorySEmitters, true);
    SoundChannelMute(PlayerGroupAll(), c_soundCategoryMusic, true);
    PlayerGroupLoopBegin(PlayerGroupAll());
    for ( ; !PlayerGroupLoopDone() ; PlayerGroupLoopStep() ) {
        CameraPan(PlayerGroupLoopCurrent(), Point(0.0, 0.0), 0.0, -1, 10.0, false);
        CameraLockInput(PlayerGroupLoopCurrent(), true);
    }
    PlayerGroupLoopEnd();
    TimerStart(lib1483055B_gv_classSelectionTimer, 5000.0, false, c_timeReal);
    TriggerEnable(lib1483055B_gt_ClassSelection, true);
    TriggerEnable(lib1483055B_gt_EndClassSelection, true);
    TriggerEnable(lib1483055B_gt_ClassSelected, true);
    DialogCreate(500, 400, c_anchorCenter, 0, 0, true);
    lib1483055B_gv_classSelectionDialog = DialogLastCreated();
    DialogSetFullscreen(DialogLastCreated(), true);
    DialogControlCreateFromTemplate(DialogLastCreated(), c_triggerControlTypePanel, "ClassSelection/ClassSelection");
    lib1483055B_gv_classSelectionPanel = DialogControlLastCreated();
    DialogControlSetFullDialog(lib1483055B_gv_classSelectionPanel, PlayerGroupAll(), true);
    autoA5798C98_ae = lib1483055B_gv_classes;
    autoA5798C98_ai = 1;
    lv_classFrame = 1;
    for ( ; ( (autoA5798C98_ai >= 0 && lv_classFrame <= autoA5798C98_ae) || (autoA5798C98_ai <= 0 && lv_classFrame >= autoA5798C98_ae) ) ; lv_classFrame += autoA5798C98_ai ) {
        DialogControlHookup(lib1483055B_gv_classSelectionPanel, c_triggerControlTypePanel, "ClassFrame" + IntToString(lv_classFrame));
        lib1483055B_gv_classSelectionFrames[lv_classFrame] = DialogControlLastCreated();
        DialogControlHookup(lib1483055B_gv_classSelectionFrames[lv_classFrame], c_triggerControlTypeButton, "ClassButton");
        lib1483055B_gv_classSelectionButtons[lv_classFrame] = DialogControlLastCreated();
        DialogControlHookup(lib1483055B_gv_classSelectionFrames[lv_classFrame], c_triggerControlTypeLabel, "ClassLabel");
        lib1483055B_gv_classSelectionLabels[lv_classFrame] = DialogControlLastCreated();
        libNtve_gf_SetDialogItemText(lib1483055B_gv_classSelectionLabels[lv_classFrame], UserDataGetText("Classes", UserDataInstance("Classes", lv_classFrame), "Class Name", 1), PlayerGroupAll());
        lib1483055B_gf_ClassUnlocked(lv_classFrame);
    }
    DialogControlHookup(lib1483055B_gv_classSelectionPanel, c_triggerControlTypeLabel, "PlayerName");
    lv_playerNameLabel = DialogControlLastCreated();
    DialogControlHookup(lib1483055B_gv_classSelectionPanel, c_triggerControlTypeImage, "PlayerRankIcon");
    lv_playerRankIcon = DialogControlLastCreated();
    DialogControlHookup(lib1483055B_gv_classSelectionPanel, c_triggerControlTypeLabel, "ClassLoreFrame");
    lib1483055B_gv_classLoreFrame = DialogControlLastCreated();
    DialogControlHookup(lib1483055B_gv_classSelectionPanel, c_triggerControlTypeUnitModel, "ClassModelPreview");
    lib1483055B_gv_classModelFrame = DialogControlLastCreated();
    DialogControlHookup(lib1483055B_gv_classSelectionPanel, c_triggerControlTypePulldown, "ArmorSlotPulldown");
    lib1483055B_gv_armorSlotDropDown = DialogControlLastCreated();
    lib1483055B_gf_CreateArmorSlotDropDown(lib1483055B_gv_armorSlotDropDown);
    TriggerAddEventDialogControl(lib1483055B_gt_DropdownSelection, c_playerAny, lib1483055B_gv_armorSlotDropDown, c_triggerControlEventTypeSelectionChanged);
    autoE289EBC5_g = lib840A968C_gf_GetMarineSquadPlayers(); 
    autoE289EBC5_p = 1;
    for ( ; autoE289EBC5_p <= PlayerGroupCount(autoE289EBC5_g) ; autoE289EBC5_p += BoolToInt(lv_player == PlayerGroupPlayer(autoE289EBC5_g, autoE289EBC5_p)) ) {
        lv_player = PlayerGroupPlayer(autoE289EBC5_g, autoE289EBC5_p);
        libNtve_gf_SetDialogItemImage(lv_playerRankIcon, UserDataGetImagePath("Ranks", lib840A968C_gv_players[lv_player].lv_currentRank, "Icon", 1), PlayerGroupSingle(lv_player));
        TextExpressionSetToken("Param/Expression/lib_1483055B_C915CEAF", "B", UserDataGetText("Ranks", lib840A968C_gv_players[lv_player].lv_currentRank, "Title Full", 1));
        TextExpressionSetToken("Param/Expression/lib_1483055B_C915CEAF", "A", PlayerName(lv_player));
        libNtve_gf_SetDialogItemText(lv_playerNameLabel, TextExpressionAssemble("Param/Expression/lib_1483055B_C915CEAF"), PlayerGroupSingle(lv_player));
        lib1E3F036D_gf_SetPlayerRank(lv_player, UserDataGetImagePath("Ranks", lib840A968C_gv_players[lv_player].lv_currentRank, "Icon", 1));
    }
    DialogSetVisible(lib1483055B_gv_classSelectionDialog, PlayerGroupAll(), true);
    lib1E3F036D_gf_ShowHideTeamUI(true);
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1483055B_gt_DisplayClassSelection_Init () {
    lib1483055B_gt_DisplayClassSelection = TriggerCreate("lib1483055B_gt_DisplayClassSelection_Func");
    TriggerAddEventGeneric(lib1483055B_gt_DisplayClassSelection, lib1483055B_gv_classSelectionEvent);
}

//--------------------------------------------------------------------------------------------------
// Trigger: Class Selection
//--------------------------------------------------------------------------------------------------
bool lib1483055B_gt_ClassSelection_Func (bool testConds, bool runActions) {
    // Variable Declarations
    int lv_selectingPlayer;

    // Variable Initialization
    lv_selectingPlayer = lib1483055B_gf_GetSelectingPlayer();

    // Actions
    if (!runActions) {
        return true;
    }

    libC50FD636_gv_marines[lv_selectingPlayer].lv_class = lib1483055B_gf_GetClassSelected();
    TextExpressionSetToken("Param/Expression/lib_1483055B_22A2BB09", "A", PlayerName(lv_selectingPlayer));
    TextExpressionSetToken("Param/Expression/lib_1483055B_22A2BB09", "Class", UnitTypeGetName(UserDataGetUnit("Classes", libC50FD636_gv_marines[lv_selectingPlayer].lv_class, "Class Unit", 1)));
    TriggerDebugOutput(lib840A968C_gv_playerEvents, TextExpressionAssemble("Param/Expression/lib_1483055B_22A2BB09"), false);
    libNtve_gf_SetDialogItemText(lib1483055B_gv_classLoreFrame, UserDataGetText("Classes", libC50FD636_gv_marines[lv_selectingPlayer].lv_class, "Class Lore", 1), PlayerGroupSingle(lv_selectingPlayer));
    lib1E3F036D_gf_SetPlayerPortrait(lv_selectingPlayer, UserDataGetImagePath("Classes", libC50FD636_gv_marines[lv_selectingPlayer].lv_class, "Class Image", 1));
    libNtve_gf_SetDialogItemUnitLink(lib1483055B_gv_classModelFrame, UserDataGetUnit("Classes", libC50FD636_gv_marines[lv_selectingPlayer].lv_class, "Class Unit", 1), PlayerGroupSingle(lv_selectingPlayer));
    Wait(0.0625, c_timeGame);
    lib1483055B_gv_unitModelFrameActor = ActorFromDialogControl(lib1483055B_gv_classModelFrame);
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1483055B_gt_ClassSelection_Init () {
    lib1483055B_gt_ClassSelection = TriggerCreate("lib1483055B_gt_ClassSelection_Func");
    TriggerEnable(lib1483055B_gt_ClassSelection, false);
    lib1483055B_gf_ClassSelected(lib1483055B_gt_ClassSelection);
}

//--------------------------------------------------------------------------------------------------
// Trigger: End Class Selection
//--------------------------------------------------------------------------------------------------
bool lib1483055B_gt_EndClassSelection_Func (bool testConds, bool runActions) {
    // Actions
    if (!runActions) {
        return true;
    }

    TriggerDebugOutput(lib840A968C_gv_gameEvents, StringExternal("Param/Value/lib_1483055B_13530730"), false);
    SoundChannelMute(PlayerGroupAll(), c_soundCategoryAmbient, false);
    SoundChannelMute(PlayerGroupAll(), c_soundCategoryMusic, false);
    SoundChannelMute(PlayerGroupAll(), c_soundCategorySAmbient, false);
    SoundChannelMute(PlayerGroupAll(), c_soundCategorySEmitters, false);
    TriggerEnable(lib1483055B_gt_ClassSelection, false);
    TriggerEnable(lib1483055B_gt_EndClassSelection, false);
    PlayerGroupLoopBegin(PlayerGroupAll());
    for ( ; !PlayerGroupLoopDone() ; PlayerGroupLoopStep() ) {
        CameraLockInput(PlayerGroupLoopCurrent(), false);
    }
    PlayerGroupLoopEnd();
    DialogDestroy(lib1483055B_gv_classSelectionDialog);
    libNtve_gf_HideGameUI(true, PlayerGroupAll());
    UISetWorldVisible(PlayerGroupAll(), true);
    EnvironmentShow(c_environmentAll, true);
    GameSetMissionTimePaused(false);
    TriggerSendEvent(lib840A968C_gv_intializeEvent);
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1483055B_gt_EndClassSelection_Init () {
    lib1483055B_gt_EndClassSelection = TriggerCreate("lib1483055B_gt_EndClassSelection_Func");
    TriggerEnable(lib1483055B_gt_EndClassSelection, false);
    TriggerAddEventTimer(lib1483055B_gt_EndClassSelection, lib1483055B_gv_classSelectionTimer);
}

//--------------------------------------------------------------------------------------------------
// Trigger: Class Selected
//--------------------------------------------------------------------------------------------------
bool lib1483055B_gt_ClassSelected_Func (bool testConds, bool runActions) {
    // Variable Declarations
    int lv_classIndex;

    // Variable Initialization

    // Actions
    if (!runActions) {
        return true;
    }

    while ((EventDialogControl() != lib1483055B_gv_classSelectionButtons[lv_classIndex])) {
        lv_classIndex += 1;
    }
    lib1483055B_gf_AnnounceClassSelection(UserDataInstance("Classes", lv_classIndex), EventPlayer());
    IntLoopBegin(lib1E3F036D_gv_indexBaseValue, lib1483055B_gv_classes);
    for ( ; !IntLoopDone() ; IntLoopStep() ) {
        if ((lib1483055B_gv_classSelectionButtons[lv_classIndex] != EventDialogControl())) {
            libNtve_gf_SetDialogItemToggled(lib1483055B_gv_classSelectionButtons[lv_classIndex], false, PlayerGroupSingle(EventPlayer()));
        }
    }
    IntLoopEnd();
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib1483055B_gt_ClassSelected_Init () {
    lib1483055B_gt_ClassSelected = TriggerCreate("lib1483055B_gt_ClassSelected_Func");
    TriggerEnable(lib1483055B_gt_ClassSelected, false);
    TriggerAddEventDialogControl(lib1483055B_gt_ClassSelected, c_playerAny, c_invalidDialogControlId, c_triggerControlEventTypeClick);
}

void lib1483055B_InitTriggers () {
    lib1483055B_gt_DropdownSelection_Init();
    lib1483055B_gt_DisplayClassSelection_Init();
    lib1483055B_gt_ClassSelection_Init();
    lib1483055B_gt_EndClassSelection_Init();
    lib1483055B_gt_ClassSelected_Init();
}

//--------------------------------------------------------------------------------------------------
// Library Initialization
//--------------------------------------------------------------------------------------------------
bool lib1483055B_InitLib_completed = false;

void lib1483055B_InitLib () {
    if (lib1483055B_InitLib_completed) {
        return;
    }

    lib1483055B_InitLib_completed = true;

    lib1483055B_InitLibraries();
    lib1483055B_InitVariables();
    lib1483055B_InitTriggers();
}

include "Lib840A968C"

